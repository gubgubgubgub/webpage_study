<!doctype html>
<html lang="ko">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <!-- 구글 템플릿 -->
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR&display=swap" rel="stylesheet">
  <!-- 부트스트랩 css 사용 -->
  <link rel="stylesheet" type="text/css" href="css/bootstrap.css">
  <!-- 부가적인 테마 -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap-theme.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.0/font/bootstrap-icons.css">
  <!-- cdn-->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" >
  <!-- 내가 사용하는 css  -->
   <link rel="stylesheet" type="text/css" href="css/styles.css">
</head>

<body>
  <div class="wrap">
    <div class="intro_bg">
      <div class="header">
        <!-- Navigation-->
        <nav class="navbar navbar-expand-md navbar-dark bg-dark fixed-top">
          <a class="navbar-brand" href="#">모든 해드립니다</a>
          <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
          </button>
            <form class="form-inline my-2 my-lg-0">
              <input class="form-control mr-sm-2" type="search" placeholder="Search" aria-label="Search">
              <button class="btn btn-outline-success my-2 my-sm-0" type="submit">Search</button>
            </form>
          <div class="collapse navbar-collapse justify-content-end" id="navbarNav">
            <ul class="navbar-nav">
              <li class="nav-item dropdown">
                <a class="nav-link dropdown-toggle" href="#" id="navbarDarkDropdownMenuLink" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                  메뉴
                </a>
                <div class="dropdown-menu dropdown-menu-dark" aria-labelledby="navbarDarkDropdownMenuLink">
                  <a class="dropdown-item" href="#">대행 알바</a>
                  <a class="dropdown-item" href="#">줄서기 알바</a>
                  <a class="dropdown-item" href="#">심부름 알바</a>
                </div>
              </li>
              <li class="nav-item">
                <a type="button" class="nav-link" data-toggle="modal" data-target="#loginModal">
                  로그인
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="sign_up_page.html">무료 회원가입</a>
              </li>
              <li class="nav-item logout-btn-style" id="logout-btn" style="display:none;">
                <a class="nav-link" href="#">로그아웃</a>
              </li>
              <li class="nav-item" id="username-display" style="display:none;">
                <a class="nav-link"></a>
              </li>
            </ul>
          </div>
        </nav>
        <!-- 시간 모달  -->
        <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
        aria-hidden="true">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="myModalLabel">알림</h5>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body">
              일정 시간 동안 활동이 없습니다. 다시 활동해주세요!
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-primary" data-dismiss="modal">확인</button>
            </div>
          </div>
        </div>
        </div>
        <!-- 사이드바 -->
        <div id="sidebar">
          <div class="logo">
            모든 해드립니다
          </div>
          <ul class="list-unstyled components">
            <li>
              <a href="#" onclick="showContent('content1')">대행 알바</a>
            </li>
            <li>
              <a href="#" onclick="showContent('content2')">줄서기 알바</a>
            </li>
            <li>
              <a href="#" onclick="showContent('content3')">심부름 알바</a>
            </li>
            <li>
              <a href="#" onclick="showContent('content4')">포인트 충전</a>
            </li>
          </ul>
        </div>
        <!-- 각 페이지 창 -->
        <div class="container" style="margin-top: 100px;">
          <div class="row justify-content-center">
            <div class="col-md-8">
              <div class="card">
                <div class="card-header">게시판</div>
                <div class="card-body">
                  <!-- 검색 기능 -->
                  <form>
                    <div class="input-group">
                      <input type="text" class="form-control" placeholder="검색어를 입력하세요">
                      <div class="input-group-append">
                        <button class="btn btn-secondary" type="button">
                          검색
                        </button>
                      </div>
                    </div>
                  </form>
                  <hr>
                  <!-- 게시글 목록 -->
                  <table class="table">
                    <thead>
                      <tr>
                        <th scope="col">번호</th>
                        <th scope="col">제목</th>
                        <th scope="col">글쓴이</th>
                        <th scope="col">작성일</th>
                        <th scope="col">조회수</th>
                      </tr>
                    </thead>
                    <tbody id="postList">
                      <!-- 게시글 내용이 들어갈 부분 -->
                      <tr>
                        <th scope="row">1</th>
                        <td>대행알바 이용방법</td>
                        <td>관리자</td>
                        <td>2021-01-01</td>
                        <td>100</td>
                      </tr>
                      <tr>
                        <th scope="row">2</th>
                        <td>대행알바 가격</td>
                        <td>관리자</td>
                        <td>2021-02-02</td>
                        <td>1040</td>
                      </tr>
                    </tbody>
                  </table>
                  <!-- 페이징 기능 -->
                  <div class="container-fluid  mb-5 mr-5">
                    <div class="row">
                      <div class="col-md-8">
                        <!-- 페이징 기능 추가 -->
                        <nav aria-label="Page navigation example">
                          <ul class="pagination justify-content-center">
                            <li class="page-item">
                              <button type="button" class="btn btn-primary" data-toggle="modal"
                                data-target="#newPostModal" style="margin-right: 40px;">새 글 작성</button>
                            </li>
                            <li class="page-item"><a class="page-link" href="#">이전</a></li>
                            <li class="page-item active"><a class="page-link" href="#">1</a></li>
                            <li class="page-item"><a class="page-link" href="#">2</a></li>
                            <li class="page-item"><a class="page-link" href="#">3</a></li>
                            <li class="page-item"><a class="page-link" href="#">다음</a></li>
                          </ul>
                        </nav>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- 각 페이지 창 끝-->
    </div>
    <!-- 풋터 -->
    <div class="footer_notice_board">
      <div>LOGO</div>
      <div>
        CEO. Liam <br>
        Addr. 수원 어딘가 <br>
        Fax/Tel. 112 <br>
      </div>
    </div>
  </div>
  <!-- 새 글 작성 모달 -->
  <div class="modal fade" id="newPostModal" tabindex="-1" role="dialog" aria-labelledby="newPostModalLabel"
    aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="newPostModalLabel">새 글 작성</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <!-- 새 글 작성 폼 -->
          <form>
            <div class="form-group">
              <label for="postTitle">제목</label>
              <input type="text" class="form-control" id="postTitle">
            </div>
            <div class="form-group">
              <label for="postContent">내용</label>
              <textarea class="form-control" id="postContent" rows="5"></textarea>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">취소</button>
          <button type="button" class="btn btn-primary" id="submitPost">작성</button>
        </div>
      </div>
    </div>
  </div>
  <!-- 체크박스 클릭 시 쿠키에 저장하는 스크립트 -->
  <script>
    // 각 content클릭시 보여주는 게시글
    function getPosts(contentId) {
      var postList = document.getElementById("postList");
      postList.innerHTML = ""; // 이전 게시글 목록 제거

      // contentId에 해당하는 게시글을 가져온 후, postList에 추가합니다.
      if (contentId === "content1") {
        var post1 = "<tr><th scope='row'>1</th><td>대행알바 이용방법</td><td>관리자</td><td>2021-01-01</td><td>100</td></tr>";
        var post2 = "<tr><th scope='row'>2</th><td>대행알바 가격</td><td>관리자</td><td>2021-02-02</td><td>1040</td></tr>";
        postList.innerHTML = post1 + post2;
      } else if (contentId === "content2") {
        var post3 = "<tr><th scope='row'>1</th><td>줄서기 알바 이용방법</td><td>관리자</td><td>2021-03-03</td><td>50</td></tr>";
        var post4 = "<tr><th scope='row'>2</th><td>줄서기 알바 가격</td><td>관리자</td><td>2021-04-04</td><td>500</td></tr>";
        postList.innerHTML = post3 + post4;
      } else if (contentId === "content3") {
        var post5 = "<tr><th scope='row'>1</th><td>심부름 알바 이용방법</td><td>관리자</td><td>2021-03-03</td><td>50</td></tr>";
        var post6 = "<tr><th scope='row'>2</th><td>심부름 알바 가격</td><td>관리자</td><td>2021-04-04</td><td>800</td></tr>";
        postList.innerHTML = post5 + post6;
      } else if (contentId === "content4") {
        var post7 = "<tr><th scope='row'>1</th><td>포인트 이용방법</td><td>관리자</td><td>2021-03-03</td><td>50</td></tr>";
        var post8 = "<tr><th scope='row'>2</th><td>포인트 가격</td><td>관리자</td><td>2021-04-04</td><td>200</td></tr>";
        postList.innerHTML = post7 + post8;
      }
    }


    // 일정 시간동안 마우스나 키보드 이벤트가 없으면 모달을 띄우는 함수
    function showInactiveModal() {
      // 모달을 띄울 시간 (5분 = 300000밀리초)
      //var inactiveTime = 5000;
      var inactiveTime = 300000;
      var timeout;

      // 마우스나 키보드 이벤트가 발생하면 타이머를 초기화합니다.
      function resetTimer() {
        clearTimeout(timeout);
        timeout = setTimeout(showInactiveModal, inactiveTime);
      }

      $(document).on("mousemove keydown", function () {
        resetTimer();
      });

      // 일정 시간이 지나면 모달을 띄웁니다.
      timeout = setTimeout(function () {
        $("#myModal").modal("show");
      }, inactiveTime);
    }

    //메뉴창 표시
    function showContent(contentId) {
      const buttons = document.querySelectorAll(".list-unstyled.components li");
     buttons.forEach(function(button) {
     button.classList.remove("btn-active");
    });
    // 클릭한 버튼에 .btn-active 클래스 추가
      const activeButton = document.querySelector(`a[onclick="showContent('${contentId}')"]`);
      activeButton.parentElement.classList.add("btn-active");
        getPosts(contentId);
    }

    //테이블 작성
    document.addEventListener("DOMContentLoaded", () => {
    const newPostButton = document.querySelector('[data-target="#newPostModal"]');
    const newPostModal = document.querySelector("#newPostModal");
    const postTitle = document.querySelector("#postTitle");
    const postContent = document.querySelector("#postContent");
    const submitPostButton = document.querySelector("#newPostModal .btn-primary");
    const postList = document.querySelector("#postList");

    // 새 글 작성 버튼을 누르면 모달 초기화
    newPostButton.addEventListener("click", () => {
      postTitle.value = "";
      postContent.value = "";
    });

    // 작성 버튼을 누르면 게시글 목록에 추가
    submitPostButton.addEventListener("click", () => {
      const title = postTitle.value;
      const content = postContent.value;
      const loggedInUser = localStorage.getItem("loggedInUser"); // 로컬 스토리지에서 사용자 이름 가져오기
      const author = loggedInUser; 
      const createdAt = new Date().toISOString().slice(0, 10);

      const newRow = document.createElement("tr");

      // 번호 컬럼 추가
      const idColumn = document.createElement("th");
      idColumn.scope = "row";
      idColumn.textContent = postList.childElementCount + 1;
      newRow.appendChild(idColumn);

      // 제목 컬럼 추가
      const titleColumn = document.createElement("td");
      const titleLink = document.createElement("a");
      titleLink.textContent = title;
      titleLink.href = "#";

      titleLink.addEventListener("click", (event) => {
      event.preventDefault();

      // 게시물 내용을 표시할 모달 창 요소를 가져옵니다.
      const postContentModal = document.querySelector("#postContentModal");
      const postContentModalTitle = postContentModal.querySelector(".modal-title");
      const postContentModalBody = postContentModal.querySelector(".modal-body");

      // 모달 창에 게시물 정보를 설정합니다.
      postContentModalTitle.textContent = title;
      postContentModalBody.textContent = content;

      // 모달 창을 엽니다.
      $(postContentModal).modal("show");
      });
      titleColumn.appendChild(titleLink);
      newRow.appendChild(titleColumn);

      // 글쓴이 컬럼 추가
      const authorColumn = document.createElement("td");
      authorColumn.textContent = author;
      newRow.appendChild(authorColumn);

      // 작성일 컬럼 추가
      const dateColumn = document.createElement("td");
      dateColumn.textContent = createdAt;
      newRow.appendChild(dateColumn);

      // 조회수 컬럼 추가
      const viewColumn = document.createElement("td");
      viewColumn.textContent = 0;
      newRow.appendChild(viewColumn);

      // 테이블에 새 행 추가
      postList.appendChild(newRow);

      // 모달 창 닫기
      newPostModal.classList.remove("show");
      newPostModal.style.display = "none";
      document.body.classList.remove("modal-open");
      document.body.style.paddingRight = "0";
      const modalBackdrop = document.querySelector(".modal-backdrop");
      document.body.removeChild(modalBackdrop);
    });
  });
  
  function check_login_status(){
        // 로그인 상태 확인
        $.get('check_login.php', function(response) {
            if (response !== 'not_logged_in') {
              const loggedInUser = response.trim(); // 사용자 이름을 응답에서 가져옴
              localStorage.setItem("loggedInUser", loggedInUser); // 로컬 스토리지에 사용자 이름 저장
              $('#logout-btn').css('display', 'block');
              $('#username-display').css('display', 'block').children('a').text(loggedInUser); // 변경된 부분
              // 로그인 및 회원가입 버튼을 숨기고 사용자 이름을 표시합니다.
              $('.nav-link[data-toggle="modal"]').parent().hide(); // 로그인 버튼 숨기기
              $('a.nav-link[href="sign_up_page.html"]').parent().hide(); // 회원가입 버튼 숨기기
            }
        });
      }

    $(document).ready(function () {//시작
      showInactiveModal();
      check_login_status();
    });
  </script>
<!--  부트스트랩 js 사용 -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script type="text/javascript" src="js/bootstrap.js"></script>
 <!-- 합쳐지고 최소화된 최신 자바스크립트 -->
 <script src="js/bootstrap.min.js"></script>
 <!--번들-->
 <script src="js/bootstrap.bundle.min.js"></script>
<!--개별-->
 <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js" ></script>

</body>

</html>